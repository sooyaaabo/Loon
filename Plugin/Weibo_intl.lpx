#!name = å¾®åšè½»äº«ç‰ˆ
#!desc = è¿‡æ»¤å¾®åšè½»äº«ç‰ˆå¹¿å‘Š
#!openUrl = https://apps.apple.com/app/id1215210046
#!author = Keywos[https://github.com/Keywos], kokoryh[https://github.com/kokoryh], å¯è‰ğŸ…¥[https://github.com/luestr/ProxyResource/blob/main/README.md]
#!tag = å»å¹¿å‘Š
#!system = 
#!system_version = 
#!loon_version = 3.3.7(921)
#!homepage = https://github.com/sooyaaabo/Loon/blob/main/README.md
#!icon = https://raw.githubusercontent.com/sooyaaabo/Loon/main/Icon/App-Icon/Weibo_intl.png
#!date = 2025-12-16 20:00

# 2023-09-06 17:07:45
# https://raw.githubusercontent.com/Keywos/rule/main/script/weibo_us/wb_us.plugin
# 2025-07-09 12:09:44
# https://kelee.one/Tool/Loon/Lpx/Weibo_intl_remove_ads.lpx

[Rewrite]
# çƒ­é—¨è§†é¢‘ã€çƒ­æ¨èã€ç§ä¿¡ä¸­ç»¿æ´²çš„æ“¦è¾¹è¯±å¯¼æ¨å¹¿
^https?:\/\/api\.weibo\.c(n|om)\/\d\/(cardlist\?v_f=\d|ad\/weibointl\?) reject-dict
^https?:\/\/weibointl\.api\.weibo\.c(n|om)\/portal\.php\?a=(hot_search_users|treehole&auth=) reject-dict

# ---------- å¯è‰ğŸ…¥ ---------- #
# å¹¿å‘ŠæŠ•æ”¾é…ç½®
^https:\/\/bootpreload\.uve\.weibo\.com\/v1\/ad\/preload$ reject-dict

# å‘ç°é¡µé¢ - æ¨ªå¹…æ¨å¹¿ã€æœ€å¸¸è®¿é—®ã€ä¸»é¡µè®¿å®¢ã€çƒ­é—¨è§†é¢‘ã€çƒ­é—¨è¯é¢˜
^https:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=trends response-body-json-del data.banner data.discover data.user_footprint data.profile_accessrecord data.native_content data.topics

# å‘ç°é¡µé¢ - é¡¶éƒ¨å°Šäº«ä¼šå‘˜å›¾æ ‡å…¥å£
^https:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=trends response-body-json-jq '.data.discover |= map(select(.schema != "å°Šäº«ä¼šå‘˜"))'

# å‘ç°é¡µé¢ - è¶‹åŠ¿ - çƒ­é—¨è§†é¢‘ä¿¡æ¯æµ
^https:\/\/api\.weibo\.cn\/2\/cardlist\?v_f=2 reject-dict

# æ—¶é—´çº¿ - å…³æ³¨ - å¹¿å‘Š
^https:\/\/api\.weibo\.cn\/2\/ad\/ reject-dict
^https:\/\/api\.weibo\.cn\/2\/statuses\/friends\/timeline$ response-body-json-del advertises ad ad_version_2_weibo
^https:\/\/api\.weibo\.cn\/2\/statuses\/friends\/timeline$ response-body-json-jq '.statuses|=map(select(.ad_marked!=true))'

# æ—¶é—´çº¿ - æ¨è - å¹¿å‘Š
^https:\/\/api\.weibo\.cn\/2\/statuses\/unread_hot_timeline$ response-body-json-del ad ad_version_2_weibo
^https:\/\/api\.weibo\.cn\/2\/statuses\/unread_hot_timeline$ response-body-json-jq '.statuses|=map(select(.ad_marked!=true))'

# è¯„è®ºåŒº - å¹¿å‘Š
^https:\/\/api\.weibo\.cn\/2\/comments\/build_comments\? response-body-json-jq '.datas[].data.ad_from_comment? = true'

# è¯é¢˜ - ä¿¡æ¯æµ - å¹¿å‘Š
^https:\/\/api\.weibo\.cn\/2\/cardlist\?aid= response-body-json-jq '.cards |= map(select((.mblog?|(.ad_marked?|type=="boolean")and.ad_marked==true)or(.card_group?|type=="array"and any(.[]?;.mblog?|(.ad_marked?|type=="boolean")and.ad_marked==true))|not))'

# æœç´¢ - å¡«å……è¯
^https:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=get_searching_info reject-dict

# ---------- kokoryh ---------- #
# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=get_searching_info& mock-response-body data-type=html data="{"retcode":0,"info":"","data":{"expiration_time":"86400","cards":[{"tip":"æœç´¢å¾®åš","word":""}]}}"

# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?ct=feed&a=search_topic& mock-response-body data-type=html data="{"retcode":0,"info":"","data":[],"ext":{}}"

# ^https?:\/\/api\.weibo\.cn\/2\/statuses\/unread_hot_timeline$ response-body-json-jq 'del(.ad, .advertises, .trends) | if .statuses then .statuses |= map(select(((.promotion.type == "ad") or (.mblogtypename | IN("å¹¿å‘Š", "å»£å‘Š", "çƒ­æ¨", "ç†±æ¨"))) | not)) end'

# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=get_coopen_ads& response-body-json-jq '.data |= . + {"ad_list":[],"pic_ad":[],"gdt_video_ad_ios":[],"display_ad":0,"ad_ios_id":null,"app_ad_ios_id":null,"reserve_ad_ios_id":"","reserve_app_ad_ios_id":"","ad_duration":604800,"ad_cd_interval":604800}'

# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=trends& response-body-json-jq 'if .data.order then .data.order = ["search_topic"] end'

# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=search_topic& response-body-json-jq 'if .data.search_topic.cards[0].type == "searchtop" then del(.data.search_topic.cards[0]) end'

# ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?a=user_center& response-body-json-jq 'if .data.cards then .data.cards[].items |= map(select(.type != "personal_vip")) | .data.cards |= map(select((.items | length) > 0)) end'

[Script]
# è¶‹åŠ¿é¡µã€å¼€å±å¹¿å‘Šã€ç”¨æˆ·ä¸­å¿ƒã€çƒ­æœç½®é¡¶ã€æˆ‘çš„é¡µé¢ å°Šäº«ä¸“å±ã€ç€‘å¸ƒæµå»å¹¿å‘Š
# http-response ^https?:\/\/weibointl\.api\.weibo\.cn\/portal\.php\?(ct=(feed&a=trends|user&a=get_searching_info)|a=(get_coopen_ads|user_center|search_topic|open_app&auth|icon_center)) script-path = https://raw.githubusercontent.com/Keywos/rule/master/script/weibo_us/js/index.js, requires-body = true, tag = [å¾®åšè½»äº«ç‰ˆ]ç§»é™¤å¹¿å‘Š

# http-response ^https?:\/\/api\.weibo\.cn\/\d\/statuses\/.*timeline script-path = https://raw.githubusercontent.com/Keywos/rule/master/script/weibo_us/js/index.js, requires-body = true, tag = [å¾®åšè½»äº«ç‰ˆ]ç§»é™¤å¹¿å‘Š

# http-response ^https?:\/\/sdkapp\.uve\.weibo\.com\/interface\/sdk\/sdkad\.php script-path = https://raw.githubusercontent.com/Keywos/rule/master/script/weibo_us/js/index.js, requires-body = true, tag = [å¾®åšè½»äº«ç‰ˆ]ç§»é™¤å¹¿å‘Š

[MitM]
hostname = bootpreload.uve.weibo.com, weibointl.api.weibo.cn, api.weibo.cn