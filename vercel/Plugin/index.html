<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Loon æ’ä»¶ä»“åº“</title>

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Loon æ’ä»¶ä»“åº“">
    <meta name="format-detection" content="telephone=no">

    <link rel="icon" href="../Icon/PluginLab/LoonPluginLab.png" type="image/png">
    <link rel="apple-touch-icon" href="../Icon/PluginLab/LoonPluginLab-White.png">

    <meta name="theme-color" content="#F2F2F7" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">

    <style>
        /* CSS å˜é‡å®šä¹‰ï¼šåŒ…å«é¢œè‰²ã€é—´è·ä¸é˜´å½±é…ç½® */
        :root {
          --spacing-page-h: 1.5rem;
          --header-inner-height: 62px;
          /* æµ…è‰²æ¨¡å¼é…è‰² */
          --bg-body: #F2F2F7;
          --bg-card: #FFFFFF;
          --bg-card-hover: rgba(255, 255, 255, 0.65);
          --bg-input: #E3E3E8;
          --bg-header: rgba(242, 242, 247, 0.85);
          --text-primary: #1c1c1e;
          --text-secondary: #8e8e93;
          --text-tertiary: #aeaeb2;
          --color-accent: #007aff;
          --border-separator: #c6c6c8;
          --border-dashed: #d1d1d6;
          --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
          --shadow-hover: 0 12px 24px rgba(0, 0, 0, 0.08);
          --radius-md: 12px;
          --radius-lg: 16px;
          --glass-blur: blur(20px);
        }
    
        /* æ·±è‰²æ¨¡å¼å˜é‡è¦†ç›– */
        @media (prefers-color-scheme: dark) {
          :root {
            --bg-body: #000000;
            --bg-card: #1C1C1E;
            --bg-card-hover: rgba(44, 44, 46, 0.75);
            --bg-input: #2C2C2E;
            --bg-header: rgba(0, 0, 0, 0.85);
            --text-primary: #f2f2f7;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            --color-accent: #0a84ff;
            --border-separator: #38383a;
            --border-dashed: #3a3a3c;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.2);
            --shadow-hover: 0 12px 24px rgba(0, 0, 0, 0.4);
          }
        }
    
        /* åŸºç¡€æ ·å¼é‡ç½® */
        *,
        *::before,
        *::after {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
          -webkit-tap-highlight-color: transparent;
        }
    
        html {
          font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "PingFang SC", "Helvetica Neue", Roboto, sans-serif;
          -webkit-font-smoothing: antialiased;
          background-color: var(--bg-body);
          color: var(--text-primary);
        }
    
        body {
          line-height: 1.5;
          min-height: 100vh;
          position: relative;
          z-index: 1;
          overscroll-behavior-y: none;
        }
    
        /* é˜²æ­¢ç§»åŠ¨ç«¯æ©¡çš®ç­‹æ•ˆæœéœ²åº• */
        body::before,
        body::after {
          content: '';
          position: fixed;
          left: 0;
          width: 100%;
          height: 100vh;
          z-index: -999;
          pointer-events: none;
          background-color: var(--bg-body);
        }
    
        body::before {
          bottom: 100%;
        }
    
        body::after {
          top: 100%;
        }
    
        input,
        button {
          font-family: inherit;
          border: none;
          outline: none;
          background: transparent;
          -webkit-appearance: none;
          appearance: none;
        }
    
        /* é¡¶éƒ¨å¯¼èˆªæ æ ·å¼ */
        header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: calc(var(--header-inner-height) + env(safe-area-inset-top));
          padding-top: env(safe-area-inset-top);
          padding-left: calc(var(--spacing-page-h) + env(safe-area-inset-left));
          padding-right: calc(var(--spacing-page-h) + env(safe-area-inset-right));
          z-index: 100;
          background: var(--bg-header);
          backdrop-filter: saturate(180%) var(--glass-blur);
          -webkit-backdrop-filter: saturate(180%) var(--glass-blur);
          border-bottom: 0.5px solid var(--border-separator);
        }
    
        .header-logo img {
          height: 36px;
          display: block;
          border-radius: 8px;
        }
    
        .header-title-block {
          position: absolute;
          left: 50%;
          top: calc(50% + env(safe-area-inset-top) / 2);
          transform: translate(-50%, -50%);
          width: 100%;
          padding: 0 100px;
          text-align: center;
          pointer-events: none;
        }
    
        header h1 {
          font-size: 1.1rem;
          font-weight: 600;
          color: var(--text-primary);
        }
    
        header p {
          margin-top: 2px;
          font-size: 0.75rem;
          color: var(--text-secondary);
        }
    
        /* ç§»åŠ¨ç«¯èœå•å¼€å…³åŠ¨ç”» */
        .menu-toggle {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: flex-end;
          width: 32px;
          height: 32px;
          cursor: pointer;
          gap: 5px;
          z-index: 102;
        }
    
        .menu-toggle span {
          display: block;
          height: 2.5px;
          background-color: var(--color-accent);
          border-radius: 4px;
          transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
    
        .menu-toggle span:nth-child(1) {
          width: 22px;
        }
    
        .menu-toggle span:nth-child(2) {
          width: 16px;
          opacity: 1;
        }
    
        .menu-toggle span:nth-child(3) {
          width: 22px;
        }
    
        .menu-toggle.active span:nth-child(1) {
          transform: translateY(7.5px) rotate(45deg);
          background-color: var(--text-primary);
        }
    
        .menu-toggle.active span:nth-child(2) {
          opacity: 0;
        }
    
        .menu-toggle.active span:nth-child(3) {
          transform: translateY(-7.5px) rotate(-45deg);
          background-color: var(--text-primary);
        }
    
        /* åŠŸèƒ½èœå•åˆ—è¡¨ */
        .secondary-menu {
          position: absolute;
          top: calc(100% + 12px);
          right: calc(var(--spacing-page-h) + env(safe-area-inset-right));
          background: var(--bg-card);
          border-radius: 14px;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
          padding: 0.5rem;
          display: flex;
          flex-direction: column;
          gap: 0.2rem;
          z-index: 101;
          min-width: 180px;
          visibility: hidden;
          opacity: 0;
          transform: scale(0.92) translateY(-10px);
          transform-origin: top right;
          transition: opacity 0.2s, transform 0.2s, visibility 0.2s;
        }
    
        .secondary-menu.active {
          visibility: visible;
          opacity: 1;
          transform: scale(1) translateY(0);
        }
    
        .menu-item {
          display: flex;
          align-items: center;
          padding: 12px 14px;
          text-decoration: none;
          color: var(--text-primary);
          width: 100%;
          font-size: 0.95rem;
          border-radius: 8px;
          font-weight: 500;
          transition: background-color 0.2s;
          cursor: pointer;
        }
    
        /* ä»…åœ¨æ”¯æŒ hover çš„è®¾å¤‡ä¸Šå¯ç”¨èœå• hover æ•ˆæœ */
        @media (hover: hover) {
          .menu-item:hover {
            background-color: var(--bg-body);
          }
        }
    
        .menu-item-content {
          display: flex;
          align-items: center;
          gap: 12px;
          flex-grow: 1;
        }
    
        /* å›¾æ ‡æ ·å¼å¤„ç† */
        .icon {
          width: 22px;
          height: 22px;
          background-color: var(--color-accent);
          -webkit-mask-repeat: no-repeat;
          mask-repeat: no-repeat;
          -webkit-mask-size: 100% 100%;
          mask-size: 100% 100%;
          flex-shrink: 0;
        }
    
        .icon-telegram {
          -webkit-mask-image: url('../Icon/PluginLab/Telegram.svg');
          mask-image: url('../Icon/PluginLab/Telegram.svg');
        }
    
        .icon-github {
          -webkit-mask-image: url('../Icon/PluginLab/GitHub.svg');
          mask-image: url('../Icon/PluginLab/GitHub.svg');
        }
    
        .icon-install {
          -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3E%3C/svg%3E");
          mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z'/%3E%3C/svg%3E");
        }
    
        #install-pwa {
          display: none;
        }
    
        /* é¡µé¢ä¸»å®¹å™¨å¸ƒå±€ */
        .wrap {
          max-width: 1100px;
          margin: 0 auto;
          padding-left: calc(var(--spacing-page-h) + env(safe-area-inset-left));
          padding-right: calc(var(--spacing-page-h) + env(safe-area-inset-right));
          padding-top: calc(var(--header-inner-height) + env(safe-area-inset-top) + 1.5rem);
          padding-bottom: calc(3rem + env(safe-area-inset-bottom));
        }
    
        /* æ»šåŠ¨å…¬å‘Šæ æ ·å¼ */
        .announcement-banner {
          background-color: #fff9de;
          border: 1px solid #e1e4e8;
          border-radius: var(--radius-lg);
          margin-bottom: 1rem;
          position: relative;
          height: 50px;
          display: flex;
          align-items: center;
          cursor: pointer;
          overflow: hidden;
        }
    
        @media (prefers-color-scheme: dark) {
          .announcement-banner {
            background-color: #3a372d;
            border-color: #444;
          }
        }
    
        .banner-item {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          padding: 0 16px;
          font-size: 0.95rem;
          font-weight: 500;
          color: #1d1d1f;
          opacity: 0;
          transition: opacity 0.5s ease-in-out;
          z-index: 0;
          white-space: nowrap;
          transform: translateX(0);
        }
    
        @media (prefers-color-scheme: dark) {
          .banner-item {
            color: #e2e2e2;
          }
        }
    
        .banner-item.active {
          opacity: 1;
          z-index: 1;
        }
    
        /* æœç´¢æ¡†ä¸ç­›é€‰æ ‡ç­¾ */
        .search-box {
          margin-bottom: 2rem;
        }
    
        #search {
          width: 100%;
          padding: 12px 18px;
          font-size: 1.05rem;
          border-radius: var(--radius-md);
          background: var(--bg-input);
          color: var(--text-primary);
          transition: all 0.2s;
        }
    
        #search:focus {
          background: var(--bg-card);
          box-shadow: 0 0 0 2px var(--color-accent), var(--shadow-sm);
        }
    
        .tabs {
          display: flex;
          gap: 0.8rem;
          flex-wrap: wrap;
          margin-top: 1rem;
        }
    
        .tabs button {
          padding: 0.6rem 1.2rem;
          border-radius: 999px;
          background: var(--bg-card);
          color: var(--text-secondary);
          font-size: 0.9rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
          box-shadow: var(--shadow-sm);
        }
    
        /* ä»…åœ¨æ”¯æŒ hover çš„è®¾å¤‡ä¸Šå¯ç”¨ Tab hover æ•ˆæœ */
        @media (hover: hover) {
          .tabs button:hover {
            color: var(--text-primary);
            transform: translateY(-1px);
          }
        }
    
        .tabs button.active {
          background: var(--color-accent);
          color: #fff;
          box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
          transform: scale(1.02);
        }
    
        .section-title {
          font-size: 1.4rem;
          font-weight: 700;
          margin: 2rem 0 1rem 0.2rem;
          color: var(--text-primary);
        }
    
        /* æ’ä»¶å¡ç‰‡ç½‘æ ¼å¸ƒå±€ä¸æ ·å¼ */
        .list {
          display: grid;
          gap: 1.5rem;
          grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        }
    
        .card {
          background: var(--bg-card);
          border-radius: var(--radius-lg);
          text-decoration: none;
          color: inherit;
          position: relative;
          transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
          display: flex;
          flex-direction: column;
          box-shadow: var(--shadow-sm);
          overflow: hidden;
          height: 100%;
        }
    
        /* å…³é”®æ”¹åŠ¨ï¼ä»…åœ¨æ”¯æŒ hover çš„è®¾å¤‡ï¼ˆæ¡Œé¢ç«¯ï¼‰ä¸Šå¯ç”¨å¡ç‰‡æ”¾å¤§ã€é˜´å½±å’ŒèƒŒæ™¯è‰²å˜åŒ– */
        @media (hover: hover) {
          .card:hover {
            transform: translateY(-6px) scale(1.005);
            box-shadow: var(--shadow-hover);
            background-color: var(--bg-card-hover);
            backdrop-filter: saturate(180%) blur(10px);
            -webkit-backdrop-filter: saturate(180%) blur(10px);
            z-index: 10;
          }
        }
    
        .card:active {
          transform: scale(0.97);
          transition-duration: 0.1s;
        }
    
        .card-top {
          padding: 1.2rem 1.2rem 0.5rem 1.2rem;
          display: flex;
          align-items: flex-start;
          gap: 12px;
        }
    
        .card-icon {
          width: 48px;
          height: 48px;
          border-radius: 12px;
          object-fit: cover;
          flex-shrink: 0;
          background: #f1f1f1;
          box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
    
        @media (prefers-color-scheme: dark) {
          .card-icon {
            background: #333;
          }
        }
    
        .card-header-info {
          flex: 1;
          min-width: 0;
          display: flex;
          flex-direction: column;
          justify-content: flex-start;
          gap: 6px;
        }
    
        .card-title {
          font-size: 1.15rem;
          font-weight: 600;
          color: var(--text-primary);
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          line-height: 1.3;
        }
    
        .author-wrapper {
          display: flex;
          align-items: center;
          min-height: 20px;
          gap: 6px;
          flex-wrap: wrap;
        }
    
        .author-avatar {
          width: 22px;
          height: 22px;
          border-radius: 50%;
          object-fit: cover;
          display: block;
          background-color: rgba(0, 0, 0, 0.05);
          border: 1px solid rgba(0, 0, 0, 0.05);
          position: relative;
          transform: translateY(-1px);
          transition: transform 0.2s ease;
        }
    
        /* ä»…åœ¨æ”¯æŒ hover çš„è®¾å¤‡ä¸Šå¯ç”¨å¤´åƒæ”¾å¤§ */
        @media (hover: hover) {
          .author-avatar:hover {
            transform: scale(1.2);
          }
        }
    
        .author-avatar:active {
          transform: translateY(-1px) scale(1);
        }
    
        @media (prefers-color-scheme: dark) {
          .author-avatar {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.1);
          }
        }
    
        .card-desc {
          font-size: 0.9rem;
          color: var(--text-secondary);
          line-height: 1.6;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
          text-overflow: ellipsis;
          word-break: break-word;
          padding: 0 1.2rem;
          margin-top: 0.5rem;
          margin-bottom: 1rem;
          flex-grow: 1;
        }
    
        .card-footer {
          border-top: 1px dashed var(--border-dashed);
          padding: 0.8rem 1.2rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
          background-color: rgba(0, 0, 0, 0.01);
        }
    
        .card-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 0.4rem;
        }
    
        .tag-item {
          padding: 3px 8px;
          font-size: 0.7rem;
          font-weight: 600;
          color: var(--color-accent);
          background: rgba(0, 122, 255, 0.1);
          border-radius: 100px;
        }
    
        @media (prefers-color-scheme: dark) {
          .tag-item {
            background: rgba(10, 132, 255, 0.2);
            color: #66b2ff;
          }
        }
    
        .card-update-time {
          font-size: 0.75rem;
          color: var(--text-tertiary);
          font-weight: 500;
          white-space: nowrap;
        }
    
          .card-clicks {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            white-space: nowrap;
          }
    
        .empty {
          text-align: center;
          color: var(--text-tertiary);
          padding: 4rem 1rem;
          grid-column: 1 / -1;
        }
    
        footer {
          text-align: center;
          font-size: 0.85rem;
          color: var(--text-tertiary);
          margin-top: 2rem;
          padding-bottom: 1rem;
          line-height: 1.8;
        }
    
        /* æ¡Œé¢ç«¯å¤§å±é€‚é… */
        @media (min-width: 768px) {
          :root {
            --spacing-page-h: 2rem;
          }
    
          header {
            padding-left: 2rem;
            padding-right: 2rem;
          }
    
          .header-title-block {
            top: 50%;
          }
    
          header h1 {
            font-size: 1.4rem;
          }
    
          .secondary-menu {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            transform: none !important;
            transition: none !important;
            position: static;
            flex-direction: row;
            background: none;
            box-shadow: none;
            padding: 0;
            min-width: auto;
            align-items: center;
            gap: 0.3rem;
          }
    
          .menu-toggle {
            display: none;
          }
    
          .menu-item {
            width: auto;
            padding: 8px;
            border-radius: 50%;
            gap: 2px;
          }
    
          /* è¿™é‡Œçš„ hover åœ¨æ¡Œé¢æ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œä¸”æˆ‘ä»¬åŠ ä¸Šäº† hover:hover ç¡®ä¿é€»è¾‘ä¸€è‡´ */
          @media (hover: hover) {
            .menu-item:hover {
              background-color: rgba(0, 0, 0, 0.05);
            }
          }
    
          @media (prefers-color-scheme: dark) and (hover: hover) {
            .menu-item:hover {
              background-color: rgba(255, 255, 255, 0.1);
            }
          }
    
          .menu-item-content span:not(.icon) {
            display: none;
          }
    
          .menu-item-content {
            gap: 0;
          }
    
          #install-pwa {
            display: none !important;
          }
    
          .wrap {
            padding-left: 2rem;
            padding-right: 2rem;
            padding-top: calc(var(--header-inner-height) + 2rem);
          }
        }
    </style>
</head>

<body>
    <header>
        <div class="header-logo">
            <a href="" title="åˆ·æ–°é¡µé¢" aria-label="åˆ·æ–°é¡µé¢">
                <img src="../Icon/PluginLab/LoonPluginLab.png" alt="Loon Plugin Lab Logo">
            </a>
        </div>
        <div class="header-title-block">
            <h1>Loon æ’ä»¶ä»“åº“</h1>
            <p>ç‚¹å‡»æ’ä»¶å¡ç‰‡å³å¯è·³è½¬å®‰è£…æ’ä»¶</p>
        </div>
        <div class="header-controls">
            <button id="menu-toggle" class="menu-toggle" aria-label="æ›´å¤šåŠŸèƒ½" title="æ›´å¤šåŠŸèƒ½">
                <span></span><span></span><span></span>
            </button>
            <div id="secondary-menu" class="secondary-menu">
                <div id="install-pwa" class="menu-item" aria-label="å®‰è£…åº”ç”¨" title="å®‰è£…åº”ç”¨">
                    <div class="menu-item-content">
                        <span class="icon icon-install"></span>
                        <span>å®‰è£…åº”ç”¨</span>
                    </div>
                </div>
                <a href="https://t.me/BoEchoBot" target="_blank" class="menu-item" aria-label="Telegram" title="Telegram">
                    <div class="menu-item-content">
                        <span class="icon icon-telegram"></span>
                        <span>Telegram</span>
                    </div>
                </a>
                <a href="https://github.com/sooyaaabo/Loon" target="_blank" class="menu-item" aria-label="GitHub" title="GitHub">
                    <div class="menu-item-content">
                        <span class="icon icon-github"></span>
                        <span>GitHub</span>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <div class="wrap">
        <div class="announcement-banner" id="announcementBanner"></div>

        <div class="search-box">
            <input id="search" placeholder="æœç´¢æ’ä»¶åç§°æˆ–æ ‡ç­¾â€¦">
            <div class="tabs">
                <button class="tab active" data-cat="all">å…¨éƒ¨</button>
                <button class="tab" data-cat="å»å¹¿å‘Š">å»å¹¿å‘Š</button>
                <button class="tab" data-cat="åŠŸèƒ½å¢å¼º">åŠŸèƒ½å¢å¼º</button>
                <button class="tab" data-cat="è§£é”ä¼šå‘˜">è§£é”ä¼šå‘˜</button>
                <button class="tab" data-cat="å®šæ—¶ä»»åŠ¡">å®šæ—¶ä»»åŠ¡</button>
            </div>
        </div>

        <div class="section-title" id="sectionTitle">æ­£åœ¨åŠ è½½â€¦</div>

        <div class="list" id="list">
            <div class="empty">æ­£åœ¨ä» GitHub åŠ è½½æ’ä»¶åˆ—è¡¨ï¼Œè¯·ç¨å€™â€¦</div>
        </div>

        <footer>
            <span>æ›´æ–°æ—¶é—´</span>ï¼š<span id="updateTime">--</span>
            <br> Copyright &copy; <span id="copyright-year">2025</span> sooyaaabo. All rights reserved.
        </footer>
    </div>

    <script>
        const CLICK_API = 'https://lpxclicks.botrna.workers.dev/';
    
        // æ‰‹åŠ¨å¤„ç†æ»šåŠ¨æ¢å¤ï¼Œé¿å…é¡µé¢åˆ·æ–°åä½ç½®è·³åŠ¨
        if ('scrollRestoration' in history) {
          history.scrollRestoration = 'manual';
        }
    
        (async () => {
          // Service Worker æ³¨å†Œä¸ PWA å®‰è£…äº‹ä»¶å¤„ç†
          if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
              navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW fail:', err));
            });
          }
    
          let deferredPrompt;
          const installBtn = document.getElementById('install-pwa');
    
          window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
          });
    
          installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`Install: ${outcome}`);
            deferredPrompt = null;
            installBtn.style.display = 'none';
          });
    
          // é™æ€æ–‡æœ¬ä¸é…ç½®å¯¹è±¡
          const TEXT = {
            repoTitle: 'Loon æ’ä»¶ä»“åº“',
            repoDesc: 'ç‚¹å‡»æ’ä»¶å¡ç‰‡å³å¯è·³è½¬å®‰è£…æ’ä»¶',
            bannerWarning: 'ç¦æ­¢åœ¨ä¸­åäººæ°‘å…±å’Œå›½å¢ƒå†…å¹³å°å…¬å¼€ä¼ æ’­æœ¬ä»“åº“å†…å®¹ä»¥åŠå°†å…¶ç”¨äºä»»ä½•å•†ä¸šæˆ–éæ³•ç”¨é€”ï¼å¦‚æœ‰å‘ç°ï¼Œè¯·å‘å¹³å°ä¸¾æŠ¥ï¼',
            bannerDisclaimer: 'æœ¬ç½‘ç«™ç”±ä¸ªäººåˆ¶ä½œä¸ç»´æŠ¤ï¼Œä¸Loonå®˜æ–¹æ— å…³ã€‚',
            bannerUpdateNotice: 'è‹¥æ’ä»¶æç¤ºâ€œLoonçš„ç‰ˆæœ¬è¿‡æ—§ï¼Œæ’ä»¶åŠŸèƒ½å—é™â€ï¼Œè¯·è‡ªè¡Œå‰å¾€ App Store è¿›è¡Œè½¯ä»¶æ›´æ–°ã€‚',
            bannerRefreshNotice: 'è‹¥æ’ä»¶æç¤ºâ€œæ’ä»¶ä¸­éƒ¨åˆ†èµ„æºä¸å¯ç”¨ï¼Œæ’ä»¶åŠŸèƒ½å—é™â€ï¼Œè¯·ç‚¹å‡»æ’ä»¶è¿›å…¥è¯¦æƒ…é¡µåæ‰‹åŠ¨åˆ·æ–°ã€‚',
            searchPlaceholder: 'æœç´¢æ’ä»¶åç§°æˆ–æ ‡ç­¾â€¦',
            catAll: 'å…¨éƒ¨',
            catAdblock: 'å»å¹¿å‘Š',
            catEnhance: 'åŠŸèƒ½å¢å¼º',
            catUnlock: 'è§£é”ä¼šå‘˜',
            catCron: 'å®šæ—¶ä»»åŠ¡',
            sectionTitle: (cat, count) => `${cat} Â· ${count} ä¸ªæ’ä»¶`,
            loadingPlugins: 'æ­£åœ¨ä» GitHub åŠ è½½æ’ä»¶åˆ—è¡¨ï¼Œè¯·ç¨å€™â€¦',
            loadFailed: (msg) => `åŠ è½½æ’ä»¶å¤±è´¥ï¼š${msg}`,
            noPluginsFound: 'åœ¨ä»“åº“ä¸­æ²¡æœ‰æ‰¾åˆ°ä»»ä½• .lpx æ–‡ä»¶ã€‚',
            noMatch: 'æš‚æ— åŒ¹é…çš„æ’ä»¶',
            updateTimeLabel: 'æ›´æ–°æ—¶é—´',
            cardUpdateTime: 'æ›´æ–°äº ',
            cardNoDesc: 'æš‚æ— æè¿°',
            getFailed: 'è·å–å¤±è´¥',
            loading: 'æ­£åœ¨åŠ è½½â€¦'
          };
    
          // è·å– DOM å…ƒç´ å¼•ç”¨
          const menuToggle = document.getElementById('menu-toggle');
          const secondaryMenu = document.getElementById('secondary-menu');
          const listEl = document.getElementById('list');
          const searchEl = document.getElementById('search');
          const tabsEl = document.querySelector('.tabs');
          const sectionTitleEl = document.getElementById('sectionTitle');
          const updateTimeEl = document.getElementById('updateTime');
    
          // åˆå§‹åŒ–æ»šåŠ¨å…¬å‘Šæ å†…å®¹
          const bannerContainer = document.getElementById('announcementBanner');
          const bannerMessages = [
            TEXT.bannerWarning,
            TEXT.bannerDisclaimer,
            TEXT.bannerUpdateNotice,
            TEXT.bannerRefreshNotice
          ];
          bannerMessages.forEach((message, index) => {
            const p = document.createElement('p');
            p.className = 'banner-item';
            if (index === 0) p.classList.add('active');
            p.textContent = message;
            bannerContainer.appendChild(p);
          });
    
          // é¡µé¢æ–‡æœ¬åˆå§‹åŒ–
          document.querySelector('h1').textContent = TEXT.repoTitle;
          document.querySelector('header p').textContent = TEXT.repoDesc;
          searchEl.placeholder = TEXT.searchPlaceholder;
    
          document.querySelectorAll('.tab').forEach(btn => {
            const cat = btn.dataset.cat;
            const key = cat === 'all' ? 'All' : cat === 'å»å¹¿å‘Š' ? 'Adblock' : cat === 'åŠŸèƒ½å¢å¼º' ? 'Enhance' : cat === 'è§£é”ä¼šå‘˜' ? 'Unlock' : 'Cron';
            btn.textContent = TEXT[`cat${key}`];
          });
    
          document.querySelector('footer span').textContent = TEXT.updateTimeLabel;
          document.querySelector('#list .empty').textContent = TEXT.loadingPlugins;
          sectionTitleEl.textContent = TEXT.loading;
          document.getElementById('copyright-year').textContent = new Date().getFullYear();
    
          // ä» plugins.json è·å–æ’ä»¶åˆ—è¡¨
          let plugins = [];
          const GITHUB_REPO = 'sooyaaabo/Loon';
          const PLUGIN_DIR_PATH = 'Plugin';
          
          // ä½¿ç”¨ç›¸å¯¹è·¯å¾„åŠ è½½åŒç›®å½•ä¸‹çš„ JSON æ–‡ä»¶
          const JSON_URL = './plugins.json';
    
          try {
            // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢ç¼“å­˜
            const response = await fetch(`${JSON_URL}?t=${new Date().getTime()}`);
            if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ’ä»¶ç´¢å¼•æ–‡ä»¶');
    
            plugins = await response.json();
            
          } catch (error) {
            listEl.innerHTML = `<div class="empty">${TEXT.loadFailed(error.message)}</div>`;
            sectionTitleEl.textContent = 'Error';
            return;
          }
    
          // è·å– GitHub ä»“åº“æœ€è¿‘æäº¤æ—¶é—´
          try {
            const commitsResponse = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/commits?path=${PLUGIN_DIR_PATH}`);
            const commits = await commitsResponse.json();
            const latestCommitDate = commits[0]?.commit?.author?.date || commits[0]?.commit?.committer?.date;
            if (latestCommitDate) {
              const d = new Date(latestCommitDate);
              updateTimeEl.textContent = d.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            }
          } catch {
            updateTimeEl.textContent = TEXT.getFailed;
          }
    
          // æ’ä»¶åˆ—è¡¨è¿‡æ»¤ä¸æ¸²æŸ“é€»è¾‘
    function render(filterCat = 'all', kw = '') {
      const lowerKw = kw.toLowerCase();
    
      const filtered = plugins.filter(p => {
        const hitCat = filterCat === 'all' || p.tags.includes(filterCat);
        const hitKw =
          !lowerKw ||
          p.name.toLowerCase().includes(lowerKw) ||
          p.tags.some(tag => tag.toLowerCase().includes(lowerKw)) ||
          (p.authors || []).some(a => a.name.toLowerCase().includes(lowerKw));
        return hitCat && hitKw;
      });
    
      const catText = tabsEl.querySelector(`[data-cat="${filterCat}"]`).textContent;
      sectionTitleEl.textContent = TEXT.sectionTitle(catText, filtered.length);
      listEl.innerHTML = '';
    
      if (!filtered.length) {
        listEl.innerHTML = `<div class="empty">${TEXT.noMatch}</div>`;
        return;
      }
    
      filtered.forEach(p => {
        const card = document.createElement('a');
        card.className = 'card';
        card.href = `loon://import?plugin=${p.page_url || p.url}`;
    
        // ç‚¹å‡»é‡å…ƒç´  idï¼ˆbase64 é˜²æ­¢éæ³•å­—ç¬¦ï¼‰
        const clickId = `click-${btoa(unescape(encodeURIComponent(p.name)))}`;
    
        const tagsHtml = p.tags.map(tag => `<span class="tag-item">${tag}</span>`).join('');
        const descText =
          p.desc === 'æš‚æ— æè¿°' || p.desc === 'No description available'
            ? TEXT.cardNoDesc
            : p.desc;
    
        let authorsHtml = '';
        if (p.authors && p.authors.length > 0) {
          authorsHtml = `
            <div class="author-wrapper">
              ${p.authors
                .map(
                  a => `
                  <a href="${a.url}" target="_blank" rel="noopener noreferrer">
                    <img
                      src="${a.avatar}"
                      class="author-avatar"
                      alt="${a.name}"
                      title="${a.name}"
                      loading="lazy"
                      onerror="this.style.display='none'"
                    >
                  </a>
                `
                )
                .join('')}
            </div>
          `;
        }
    
        card.innerHTML = `
          <div class="card-top">
            ${p.icon ? `<img src="${p.icon}" class="card-icon" alt="${p.name} icon" loading="lazy">` : ''}
            <div class="card-header-info">
              <h3 class="card-title">${p.name}</h3>
              ${authorsHtml}
            </div>
          </div>
    
          <p class="card-desc">${descText}</p>
    
          <div class="card-footer">
            <div class="card-tags">${tagsHtml}</div>
            <div style="display:flex;gap:10px;align-items:center;">
              <span class="card-clicks" id="${clickId}">ğŸ‘† --</span>
              <p class="card-update-time">${p.date}</p>
            </div>
          </div>
        `;
    
        // â€”â€” ç‚¹å‡»æ—¶ä¸ŠæŠ¥ç‚¹å‡»é‡ï¼ˆä¸é˜»å¡è·³è½¬ï¼‰
        card.addEventListener('click', () => {
          fetch(`${CLICK_API}/hit`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name: p.name })
          }).catch(() => {});
        });
    
        listEl.appendChild(card);
    
        // â€”â€” å¼‚æ­¥è·å–ç‚¹å‡»é‡
        fetch(`${CLICK_API}/get?name=${encodeURIComponent(p.name)}`)
          .then(r => r.json())
          .then(d => {
            const el = document.getElementById(clickId);
            if (el && typeof d.count === 'number') {
              el.textContent = `ğŸ‘† ${d.count}`;
            }
          })
          .catch(() => {});
      });
    }
    
    
          // äº¤äº’äº‹ä»¶ç›‘å¬ï¼ˆèœå•ã€ç‚¹å‡»ã€ç­›é€‰ã€æœç´¢ï¼‰
          menuToggle.addEventListener('click', e => {
            e.stopPropagation();
            secondaryMenu.classList.toggle('active');
            menuToggle.classList.toggle('active');
          });
    
          secondaryMenu.addEventListener('click', e => {
            if (e.target.closest('#install-pwa')) return;
            if (e.target.closest('.menu-item')) {
              secondaryMenu.classList.remove('active');
              menuToggle.classList.remove('active');
            }
          });
    
          document.addEventListener('click', e => {
            if (!secondaryMenu.contains(e.target) && !menuToggle.contains(e.target) && secondaryMenu.classList.contains('active')) {
              secondaryMenu.classList.remove('active');
              menuToggle.classList.remove('active');
            }
          });
    
          tabsEl.addEventListener('click', e => {
            if (e.target.matches('.tab')) {
              tabsEl.querySelector('.active').classList.remove('active');
              e.target.classList.add('active');
              render(e.target.dataset.cat, searchEl.value);
            }
          });
    
          searchEl.addEventListener('input', () => {
            render(tabsEl.querySelector('.tab.active').dataset.cat, searchEl.value);
          });
    
          // å…¬å‘Šæ è‡ªåŠ¨æ»šåŠ¨åŠ¨ç”»é€»è¾‘
          (() => {
            const bannerEl = document.getElementById('announcementBanner');
            const bannerItems = bannerEl.querySelectorAll('.banner-item');
            const totalBanners = bannerItems.length;
            if (totalBanners <= 1) return;
    
            let currentIndex = 0;
            let bannerLoopAbort = null;
    
            const handleBannerAnimation = async (item) => {
              item.style.transition = 'none';
              item.style.transform = 'translateX(0)';
              await new Promise(r => setTimeout(r, 50));
              const containerWidth = item.clientWidth;
              const textWidth = item.scrollWidth;
              if (textWidth > containerWidth) {
                await new Promise(r => setTimeout(r, 1000));
                const offset = textWidth - containerWidth;
                const speed = 60;
                const dur = offset / speed;
                item.style.transition = `transform ${dur}s linear`;
                item.style.transform = `translateX(-${offset}px)`;
                await new Promise(r => {
                  item.addEventListener('transitionend', r, { once: true });
                });
                await new Promise(r => setTimeout(r, 1000));
              } else {
                await new Promise(r => setTimeout(r, 2500));
              }
              item.style.transition = 'none';
              item.style.transform = 'translateX(0)';
            };
    
            const startBannerLoop = async () => {
              bannerLoopAbort?.abort();
              bannerLoopAbort = new AbortController();
              const signal = bannerLoopAbort.signal;
              bannerItems.forEach((item, index) => {
                if (index !== currentIndex) item.classList.remove('active');
              });
              bannerItems[currentIndex].classList.add('active');
              while (!signal.aborted) {
                const item = bannerItems[currentIndex];
                await handleBannerAnimation(item);
                if (signal.aborted) break;
                item.classList.remove('active');
                currentIndex = (currentIndex + 1) % totalBanners;
                bannerItems[currentIndex].classList.add('active');
                await new Promise(r => setTimeout(r, 600));
              }
            };
    
            bannerEl.addEventListener('click', () => {
              if (!bannerLoopAbort) return;
              bannerLoopAbort.abort();
              currentIndex = (currentIndex + 1) % totalBanners;
              startBannerLoop();
            });
    
            startBannerLoop();
          })();
    
          // å¯åŠ¨é¦–æ¬¡æ¸²æŸ“
          if (plugins.length > 0) render('all', '');
        })();
    </script>
</body>

</html>
